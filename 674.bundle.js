(()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}var i,n,r,a,h,o,l,g,f="rgb(16,7,25)",u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function c(t){return t.map((function(t){return t%12}))}function d(){if(n&&o){for(var t=function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;return t.map((function(t){return e*Math.pow((t-i)/(n-i),r)}))}([0,1,2,3,4,5,6,7,8,9,10,11],n.height,-.5,11.5,1),e=0;e<t.length;e++)o.fillStyle="rgba(208, 215, 222, 0.5)",o.fillRect(35,n.height-t[e],1*g,1);for(var i=0;i<t.length;i++)o.fillStyle="rgba(208, 215, 222, 1)",o.fillText("".concat(u[i]),10,n.height-t[i]+7)}}self.onmessage=function(e){var s=e.data,y=s.type,m=s.data;switch(y){case"init":e.data.isFFTDetail?(r=e.data.mainCanvas,a=e.data.bgCanvas,l=r.getContext("2d"),a.getContext("2d"),l.font="12px Signika",g=e.data.historySize):(i=e.data.mainCanvas,n=e.data.bgCanvas,h=i.getContext("2d"),(o=n.getContext("2d")).font="20px Signika",h.font="20px Signika",g=e.data.historySize,d());break;case"render":m.isFFTDetail?function(e){if(r&&l&&e.currentFs){l.fillStyle=f,l.fillRect(0,0,r.width,r.height);var i=t(e.currentRawFs).sort((function(t,e){return e.magnitude-t.magnitude})).slice(0,1e3),n=i.length>0?i[i.length/20].magnitude:1e9;if(0!==(i=t(i).sort((function(t,e){return t.frequency-e.frequency}))).length){l.strokeStyle="rgba(255, 255, 255, 0.7)",l.lineWidth=2,l.beginPath();for(var a=Math.log2(20),h=Math.log2(2e4)-a,o=1;o<i.length-1;o++){var g=(Math.log2(i[o].frequency)-a)/h*r.width,c=r.height-i[o].magnitude*r.height*.9;if(l.beginPath(),l.arc(g,c,2,0,2*Math.PI),l.fillStyle="rgba(255, 255, 255, 0.7)",l.fill(),i[o].magnitude>n&&c<.95*r.height&&i[o].magnitude>i[o-1].magnitude&&i[o].magnitude>i[o+1].magnitude){l.fillStyle="white",l.font="12px Signika";var d=12*Math.log2(i[o].frequency/440)+69,s=u[Math.round(d)%12];l.fillText("".concat(i[o].frequency.toFixed(1)," Hz (").concat(s,")"),g,c-10)}}}}}(m.state):function(t){if(i&&h&&0!=t.fHistory.length){var e=t.fHistory.length;h.drawImage(i,e,0,i.width-e,i.height,0,0,i.width-e,i.height),h.fillStyle=f,h.fillRect(i.width-e,0,e,i.height);for(var n=0;n<t.fHistory.length;n++)if(null!==t.fHistory[n]&&0!=t.fHistory[n].length)for(var r=t.fHistory[n].slice(0,30),a=r.map((function(t){return t.frequency>31?12*Math.log2(t.frequency/440)+69:0})),o=c(a),l=o.map((function(t){return 30*(t+3)})),g=0;g<a.length;g++){var u=l[g],d=o[g];h.beginPath(),h.fillStyle="hsla(".concat(u,", 100%, 70%, ").concat(r[g].magnitude,")"),h.arc(i.width-n,i.height-(d+.5)%12/12*i.height,1.5,0,2*Math.PI),h.fill()}}}(m.state);break;case"resize":m.isFFTDetail?(r.width=m.width,r.height=m.height,a.width=m.width,a.height=m.height):(i.width=m.width,i.height=m.height,n.width=m.width,n.height=m.height,d()),g=m.historySize}}})();
//# sourceMappingURL=674.bundle.js.map