(()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var n,r,i,a,o,l,f,h="rgb(16,7,25)",g=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function u(t){return t.map((function(t){return t%12}))}var c=0;self.onmessage=function(e){var s=e.data,d=s.type,y=s.data;if(y.isFFTDetail)switch(d){case"init":i=y.mainCanvas,a=y.bgCanvas,f=i.getContext("2d"),a.getContext("2d"),f.font="12px Signika";break;case"render":!function(e){if(i&&f&&e.currentFs&&0!==e.currentRawFs.length){f.fillStyle=h,f.fillRect(0,0,i.width,i.height);var n=t(e.currentRawFs).sort((function(t,e){return e.magnitude-t.magnitude})).slice(0,1e3),r=n.length>0?n[.1*n.length].magnitude:1e9;if(c=Math.max(.99995*c,n[0].magnitude),0!==(n=t(n).sort((function(t,e){return t.frequency-e.frequency}))).length){f.strokeStyle="rgba(255, 255, 255, 0.7)",f.lineWidth=2,f.beginPath();for(var a=Math.log2(20),o=Math.log2(2e4)-a,l=1;l<n.length-1;l++){var u=(Math.log2(n[l].frequency)-a)/o*i.width,s=i.height-n[l].magnitude/c*i.height*.9;if(f.beginPath(),f.arc(u,s,2,0,2*Math.PI),f.fillStyle="rgba(255, 255, 255, 0.7)",f.fill(),n[l].magnitude>r&&s<.9*i.height&&n[l].magnitude>n[l-1].magnitude&&n[l].magnitude>n[l+1].magnitude){f.fillStyle="white",f.font="12px Signika";var d=12*Math.log2(n[l].frequency/440)+69,y=g[Math.round(d)%12];f.fillText("".concat(n[l].frequency.toFixed(1)," Hz (").concat(y,")"),u,s-10)}}}}}(y.state)}else switch(d){case"init":n=y.mainCanvas,r=y.bgCanvas,o=n.getContext("2d"),(l=r.getContext("2d")).font="20px Signika",o.font="20px Signika",function(){if(r&&l){for(var t=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;return t.map((function(t){return e*Math.pow((t-n)/(r-n),i)}))}([0,1,2,3,4,5,6,7,8,9,10,11],r.height,-.5,11.5,1),e=0;e<t.length;e++)l.fillStyle="rgba(208, 215, 222, 0.5)",l.fillRect(35,r.height-t[e],n.width,1);for(var i=0;i<t.length;i++)l.fillStyle="rgba(208, 215, 222, 1)",l.fillText("".concat(g[i]),10,r.height-t[i]+7)}}();break;case"render":(function(t){if(n&&o&&0!=t.fHistory.length){var e=Math.round(.3*t.fHistory.length);o.drawImage(n,e,0,n.width-e,n.height,0,0,n.width-e,n.height),o.fillStyle=h,o.fillRect(n.width-e,0,e,n.height);for(var r=0;r<t.fHistory.length;r++)if(null!==t.fHistory[r]&&0!=t.fHistory[r].length)for(var i=t.fHistory[r].slice(0,30),a=i.map((function(t){return t.frequency>31?12*Math.log2(t.frequency/440)+69:0})),l=u(a),f=l.map((function(t){return 30*(t+3)})),g=0;g<a.length;g++){var c=f[g],s=l[g];o.beginPath(),o.fillStyle="hsla(".concat(c,", 100%, 70%, ").concat(i[g].magnitude,")"),o.arc(n.width-r,n.height-(s+.5)%12/12*n.height,1,0,2*Math.PI),o.fill()}}})(y.state)}}})();
//# sourceMappingURL=674.bundle.js.map